@page "/appointment"

@using System.Net
@using HarrisPharmacy.App.Data
@using HarrisPharmacy.App.Data.Entities.Patients
@using HarrisPharmacy.App.Data.Interfaces
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Mvc.Rendering
@using Microsoft.Data.SqlClient
@inject IAppointmentService AppointmentService
@inject ApplicationDbContext Context

<h3>Appointments</h3>
<h5>Patient Id</h5>
<input @bind="@PatientId" type="text" placeholder="Patient Id" />
<h5>User Id</h5>
<input @bind="@UserId" type="text" placeholder="User Id" />
<h5>Start Time</h5>
<input @bind="@StartTime" type="text" placeholder="Start Time" />
<h5>End Time</h5>
<input @bind="@EndTime" type="text" placeholder="End Time" />
<h5>Location</h5>
<input @bind="@Location" type="text" placeholder="Location" />
<br />
<button @onclick="@CreateAppointment" class="btn btn-warning">Add Appointment</button>

@code {
    public SelectListItem Item { get; set; } = null!;

    private string PatientId { get; set; }
    private string UserId { get; set; }
    private string StartTime { get; set; }
    private string EndTime { get; set; }
    private string Location { get; set; }
    /// <summary>
    /// Inserts a new Appointment into the db using appointment service
    /// </summary>
    /// <returns></returns>
    protected async Task CreateAppointment()
    {
        PatientList appointment = new PatientList()
        {
            PatientListId = Guid.NewGuid().ToString(),
            UserId = UserId,
            StartTime = StartTime,
            EndTime = EndTime,
            Location = Location,
        };
        await AppointmentService.InsertAsync(appointment);
        ClearFields();
        await OnInitializedAsync();
    }
    protected void ClearFields()
    {
        PatientId = string.Empty;
        UserId = string.Empty;
        StartTime = string.Empty;
        EndTime = string.Empty;
        Location = string.Empty;
    }
}